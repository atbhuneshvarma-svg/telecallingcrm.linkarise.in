import{ac as k,r as c,j as t,q as P,aC as $,aD as b}from"./index-BJcvY-Fc.js";const E="https://leadzcrm.linkarise.in",A=`${E}/api/activitylog`,R={getActivityLogs:async(e={})=>(await k.post(A,{page:e.page||1,per_page:e.per_page||10,module:e.module,action:e.action,user_id:e.user_id,start_date:e.start_date,end_date:e.end_date,search:e.search})).data,exportActivityLogs:async(e={})=>(await k.post(`${A}/export`,{page:e.page||1,per_page:e.per_page||10,module:e.module,action:e.action,user_id:e.user_id,start_date:e.start_date,end_date:e.end_date,search:e.search},{responseType:"blob",headers:{Accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}})).data},T=e=>{const[l,n]=c.useState(null),[m,r]=c.useState(!0),[i,d]=c.useState(null),v=c.useRef(),_=async()=>{try{r(!0),d(null);const s=await R.getActivityLogs(e);n(s)}catch(s){d(s instanceof Error?s.message:"Failed to fetch activity logs")}finally{r(!1)}};return c.useEffect(()=>{JSON.stringify(v.current)!==JSON.stringify(e)&&(v.current=e,_())},[e]),{logs:l,loading:m,error:i,refetch:()=>{_()}}},D=({title:e,subtitle:l,onRefresh:n,loading:m=!1})=>t.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"fw-bold text-gray-800",children:e}),l&&t.jsx("span",{className:"text-muted",children:l})]}),n&&t.jsx("button",{className:"btn btn-primary d-flex align-items-center gap-2",onClick:n,disabled:m,children:m?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"spinner-border spinner-border-sm",role:"status",children:t.jsx("span",{className:"visually-hidden",children:"Loading..."})}),"Refreshing..."]}):t.jsxs(t.Fragment,{children:[t.jsx("i",{className:"fas fa-sync-alt"}),"Refresh"]})})]}),M=({logs:e,loading:l,currentPage:n,perPage:m})=>{const{mode:r}=P(),i=r==="dark",[d,v]=c.useState("created_at"),[_,j]=c.useState("desc"),s=a=>{if(!a)return"-";const u=new Date(a),g=String(u.getDate()).padStart(2,"0"),f=String(u.getMonth()+1).padStart(2,"0"),N=u.getFullYear(),L=String(u.getHours()).padStart(2,"0"),S=String(u.getMinutes()).padStart(2,"0");return`${g}-${f}-${N} ${L}:${S}`},h=a=>{switch(a==="Add"&&(a="Create"),a=a==null?void 0:a.trim(),a){case"Login":return"badge bg-success text-white px-2";case"Edit":return"badge bg-warning text-dark px-2";case"Create":return"badge bg-info text-white px-2";case"Delete":return"badge bg-danger text-white px-2";case"Allocate":return"badge bg-primary text-white px-2";case"Import":return"badge bg-warning text-white px-2";case"Status Update":return"badge bg-dark text-white px-2";case"Transferred":return"badge bg-info text-white px-2";default:return"badge bg-light text-dark px-2"}},y=c.useMemo(()=>e.length?[...e].sort((a,u)=>{let g=a[d],f=u[d];return d==="created_at"&&(g=new Date(g).getTime(),f=new Date(f).getTime()),typeof g=="string"&&typeof f=="string"&&(g=g.toLowerCase(),f=f.toLowerCase()),g<f?_==="asc"?-1:1:g>f?_==="asc"?1:-1:0}):[],[e,d,_]),C=[{name:"#",width:"70px",cell:(a,u)=>(n-1)*m+u+1},{name:"Module",selector:a=>a.module,sortable:!0,cell:a=>t.jsx("span",{className:" fw-bold fs-7",children:a.module})},{name:"Action",selector:a=>a.action,sortable:!0,cell:a=>t.jsxs("span",{className:h(a.action),children:[a.action," "]})},{name:"Description",selector:a=>a.description,sortable:!0,wrap:!0},{name:"IP Address",selector:a=>a.ip_address,sortable:!0,cell:a=>t.jsx("code",{children:a.ip_address})},{name:"Created At",selector:a=>a.created_at,sortable:!0,cell:a=>s(a.created_at)}],w=Array.from({length:10}).map((a,u)=>({logmid:u,cmpmid:0,usermid:0,record_id:0,module:"",action:"",description:"",ip_address:"",created_at:""}));return t.jsx($,{columns:C,data:l?w:y,highlightOnHover:!0,pointerOnHover:!0,striped:!0,responsive:!0,noHeader:!0,customStyles:{table:{style:{backgroundColor:r==="dark"?"#1e1e2f":void 0}},headCells:{style:{fontSize:"1.2em",fontWeight:"700",backgroundColor:r==="dark"?"#2a2a3d":"#f8f9fa",color:r==="dark"?"#fff":void 0}},cells:{style:{backgroundColor:i?"#1a1a1a":"#f8f9fa",color:r==="dark"?"#fff":void 0}}},progressPending:l,progressComponent:t.jsx("div",{className:"text-center py-4",children:t.jsx("div",{className:"placeholder-wave w-100",children:Array.from({length:6}).map((a,u)=>t.jsx("div",{className:"placeholder col-12 mb-2",style:{height:"20px",borderRadius:"4px",backgroundColor:r==="dark"?"#444":"#e0e0e0"}},u))})})})},F=({logs:e,loading:l,onPageChange:n})=>{const m=c.useCallback(()=>{const r=e.current_page,i=e.total_pages;return i<=7?Array.from({length:i},(d,v)=>v+1):r<=3?[1,2,3,4,"...",i]:r>=i-2?[1,"...",i-3,i-2,i-1,i]:[1,"...",r-1,r,r+1,"...",i]},[e]);return t.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-4",children:[t.jsxs("div",{className:"text-muted",children:["Showing ",(e.current_page-1)*e.per_page+1," to ",Math.min(e.current_page*e.per_page,e.total_records)," of ",e.total_records," entries"]}),t.jsx("nav",{children:t.jsxs("ul",{className:"pagination pagination-sm",children:[t.jsx("li",{className:`page-item ${e.current_page===1?"disabled":""}`,children:t.jsx("button",{className:"page-link",onClick:()=>n(e.current_page-1),disabled:e.current_page===1||l,children:"Previous"})}),m().map((r,i)=>t.jsx("li",{className:`page-item ${r===e.current_page?"active":""} ${r==="..."?"disabled":""}`,children:r==="..."?t.jsx("span",{className:"page-link",children:"..."}):t.jsx("button",{className:"page-link",onClick:()=>n(r),disabled:l,children:r})},i)),t.jsx("li",{className:`page-item ${e.current_page===e.total_pages?"disabled":""}`,children:t.jsx("button",{className:"page-link",onClick:()=>n(e.current_page+1),disabled:e.current_page===e.total_pages||l,children:"Next"})})]})})]})},I=({perPage:e,searchTerm:l,loading:n,onPerPageChange:m,onSearchChange:r,searchResultsCount:i})=>t.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[t.jsxs("div",{className:"d-flex align-items-center gap-2",children:[t.jsx("span",{className:"text-muted",children:"Show"}),t.jsxs("select",{className:"form-select form-select-sm w-auto",value:e,onChange:m,disabled:n,children:[t.jsx("option",{value:"10",children:"10"}),t.jsx("option",{value:"25",children:"25"}),t.jsx("option",{value:"50",children:"50"}),t.jsx("option",{value:"100",children:"100"})]}),t.jsx("span",{className:"text-muted",children:"entries"})]}),t.jsxs("div",{className:"d-flex align-items-center gap-2",children:[t.jsx("span",{className:"text-muted",children:"Search:"}),t.jsx("input",{type:"text",className:"form-control form-control-sm",placeholder:"Search in action, description, module or IP...",value:l,onChange:r,disabled:n,style:{width:"300px"}}),l&&t.jsxs("span",{className:"text-muted small",children:["(",i||0," results)"]})]})]}),H=()=>{const[e,l]=c.useState([]),[n,m]=c.useState(""),[r,i]=c.useState(1),[d,v]=c.useState(10),[_,j]=c.useState({page:1,per_page:10}),{logs:s,loading:h,error:y,refetch:C}=T(_),w=()=>{C(),b.info("Refreshing activity logs...",{position:"top-right",autoClose:2e3})};c.useEffect(()=>{y&&b.error(`Failed to load activity logs: ${y}`,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0})},[y]),c.useEffect(()=>{if(s&&!h&&!y){const o=s.total_records;o>0&&b.success(`Loaded ${o} activity logs successfully`,{position:"top-right",autoClose:3e3,hideProgressBar:!0})}},[s,h,y]),c.useEffect(()=>{s!=null&&s.data&&l(o=>{const p=new Map(o.map(x=>[x.logmid,x]));return s.data.forEach(x=>{p.set(x.logmid,x)}),Array.from(p.values())})},[s==null?void 0:s.data]);const a=c.useMemo(()=>{if(!n.trim())return e;const o=n.toLowerCase().trim(),p=e.filter(x=>x.action.toLowerCase().includes(o)||x.description.toLowerCase().includes(o)||x.module.toLowerCase().includes(o)||x.ip_address.toLowerCase().includes(o));return n.trim()&&!h&&(p.length===0?b.info("No results found for your search",{position:"top-right",autoClose:3e3}):b.info(`Found ${p.length} results for "${n}"`,{position:"top-right",autoClose:3e3})),p},[e,n,h]),u=c.useMemo(()=>{const o=(r-1)*d,p=o+d;return a.slice(o,p)},[a,r,d]),g=a.length,f=Math.ceil(g/d),N=o=>{m(o.target.value),i(1)},L=o=>{const p=parseInt(o.target.value);b.info(`Showing ${p} entries per page`,{position:"top-right",autoClose:2e3}),v(p),i(1),p>d&&j({page:1,per_page:p})},S=o=>{i(o),o!==r&&b.info(`Navigated to page ${o}`,{position:"top-right",autoClose:2e3,hideProgressBar:!0}),n.trim()||j({page:o,per_page:d})};return c.useEffect(()=>{j({page:1,per_page:d});const o=b.loading("Loading activity logs...",{position:"top-right"}),p=setTimeout(()=>{b.dismiss(o)},1e3);return()=>clearTimeout(p)},[]),c.useEffect(()=>{!h&&(s!=null&&s.data)&&s.data.length===0&&!n.trim()&&b.info("No activity logs available",{position:"top-right",autoClose:4e3})},[s==null?void 0:s.data,h,n]),t.jsx("div",{className:"card",children:t.jsxs("div",{className:"card-body",children:[t.jsx(D,{title:"Activity Logs Report",onRefresh:w,loading:h}),t.jsx(I,{perPage:d,searchTerm:n,loading:h,onPerPageChange:L,onSearchChange:N}),t.jsx(M,{logs:n.trim()?u:(s==null?void 0:s.data)||[],loading:h&&(n.trim()?u.length===0:!0),currentPage:r,perPage:d}),(g>0||((s==null?void 0:s.total_records)||0)>0)&&t.jsx(F,{logs:{current_page:r,per_page:d,total_records:n.trim()?g:(s==null?void 0:s.total_records)||0,total_pages:n.trim()?f:(s==null?void 0:s.total_pages)||0},loading:h,onPageChange:S})]})})};export{H as ActivityLogsPage};
