import{ac as N,j as t,q as C,r as x,aC as _,aE as S,aF as v,aG as f,aH as k}from"./index-BJcvY-Fc.js";const E="https://leadzcrm.linkarise.in/api",D={async getStageWiseLeads(o=1){return(await N.post(`${E}/lead/stagewise`,{page:o})).data.data}},L=({filters:o,onFilterChange:p,onReset:r,onFetch:g,leads:i})=>{const c=[...new Set(i.map(e=>e.campaign))],n=[...new Set(i.map(e=>e.telecaller))],u=[...new Set(i.map(e=>e.stage))],l=(e,s)=>{p({...o,[e]:s})};return t.jsxs("div",{className:"d-flex gap-3 mb-3",children:[t.jsxs("select",{className:"form-select",value:o.campaign,onChange:e=>l("campaign",e.target.value),children:[t.jsx("option",{value:"",children:"Select Campaign"}),c.map(e=>t.jsx("option",{value:e,children:e},e))]}),t.jsxs("select",{className:"form-select",value:o.user,onChange:e=>l("user",e.target.value),children:[t.jsx("option",{value:"",children:"Select User"}),n.map(e=>t.jsx("option",{value:e,children:e},e))]}),t.jsxs("select",{className:"form-select",value:o.stage,onChange:e=>l("stage",e.target.value),children:[t.jsx("option",{value:"",children:"Select Stage"}),u.map(e=>t.jsx("option",{value:e,children:e},e))]}),t.jsx("button",{className:"btn btn-primary",onClick:g,children:"Submit"}),t.jsx("button",{className:"btn btn-secondary",onClick:r,children:"Reset"})]})},M=({leads:o,loading:p,pagination:r,onPageChange:g})=>{const{mode:i}=C(),c=i==="dark",[n,u]=x.useState(!1);x.useEffect(()=>{if(p)u(!0);else{const a=setTimeout(()=>u(!1),2e3);return()=>clearTimeout(a)}},[p]);const l=Array.from({length:r.per_page||10}).map((a,m)=>({leadmid:m,campaign:"",telecaller:"",prospectname:"",mobile:"",stage:"",stagedate:"",created_at:""})),e=a=>{if(!a)return"";const m=new Date(a);return isNaN(m.getTime())?"":S(m,"dd-MM-yyyy")},s=()=>t.jsx("div",{className:"placeholder-wave w-100",children:t.jsx("span",{className:"placeholder col-12",style:{height:"20px",display:"block",borderRadius:"4px"}})}),h=[{name:"Sr.No",cell:(a,m)=>n?t.jsx(s,{}):m+1+(r.page-1)*r.per_page,width:"80px",center:!0},{name:"Campaign",cell:a=>n?t.jsx(s,{}):a.campaign,sortable:!0},{name:"User",cell:a=>n?t.jsx(s,{}):a.telecaller,sortable:!0},{name:"Lead Name",cell:a=>n?t.jsx(s,{}):a.prospectname,sortable:!0},{name:"Mobile",cell:a=>n?t.jsx(s,{}):a.mobile,center:!0},{name:"Stage",cell:a=>n?t.jsx(s,{}):a.stage,sortable:!0},{name:"Stage Date",cell:a=>n?t.jsx(s,{}):e(a.stagedate),sortable:!0,center:!0},{name:"Added On",cell:a=>n?t.jsx(s,{}):e(a.created_at),sortable:!0,center:!0}],d={headCells:{style:{backgroundColor:c?"#1a1a1a":"#f8f9fa",color:c?"#ccc":"#333",fontWeight:600,fontSize:"14px",borderBottom:c?"2px solid #333":"2px solid #dee2e6",padding:"12px 15px"}},cells:{style:{fontSize:"14px",color:c?"#ccc":"#333",backgroundColor:c?"#1a1a1a":"#f8f9fa",padding:"12px 15px",borderBottom:c?"1px solid #333":"1px solid #dee2e6"}}};return t.jsx(_,{columns:h,data:n?l:o,customStyles:d,striped:!0,highlightOnHover:!0})},T=({data:o,pagination:p,filename:r="leads_export",exportType:g="excel"})=>{const i=()=>o.map((e,s)=>({"Sr.No":s+1+(p.page-1)*p.per_page,Campaign:e.campaign||"",User:e.telecaller||"","Lead Name":e.prospectname||"",Mobile:e.mobile||"",Stage:e.stage||"","Stage Date":e.stagedate?S(new Date(e.stagedate),"dd-MM-yyyy"):"","Added On":e.created_at?S(new Date(e.created_at),"dd-MM-yyyy"):"","Lead ID":e.leadmid||""})),c=()=>{const e=i(),s=Object.keys(e[0]||{}),h=[s.join(","),...e.map(a=>s.map(m=>{const j=a[m],b=String(j);return b.includes(",")||b.includes('"')||b.includes(`
`)?`"${b.replace(/"/g,'""')}"`:b}).join(","))].join(`
`),d=new Blob([h],{type:"text/csv;charset=utf-8;"});v.saveAs(d,`${r}.csv`)},n=()=>{const e=i(),s=f.book_new(),h=f.json_to_sheet(e),d=[];e.forEach(j=>{Object.values(j).forEach((b,y)=>{const w=String(b).length;d[y]=Math.max(d[y]||0,w)})}),h["!cols"]=d.map(j=>({wch:Math.min(j+2,50)})),f.book_append_sheet(s,h,"Leads");const a=k(s,{bookType:"xlsx",type:"array"}),m=new Blob([a],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});v.saveAs(m,`${r}.xlsx`)},u=()=>{g==="excel"?n():c()},l=e=>{e==="excel"?n():c()};return t.jsxs("div",{className:"btn-group mt-3",children:[t.jsxs("button",{className:"btn btn-success",onClick:u,disabled:o.length===0,children:[t.jsx("i",{className:"bi bi-download me-2"}),"Export ",g==="excel"?"Excel":"CSV"," (",o.length,")"]}),t.jsx("button",{type:"button",className:"btn btn-success dropdown-toggle dropdown-toggle-split","data-bs-toggle":"dropdown","aria-expanded":"false",disabled:o.length===0,children:t.jsx("span",{className:"visually-hidden",children:"Toggle Dropdown"})}),t.jsxs("ul",{className:"dropdown-menu",children:[t.jsx("li",{children:t.jsxs("button",{className:"dropdown-item",onClick:()=>l("excel"),children:[t.jsx("i",{className:"bi bi-file-earmark-excel me-2 text-success"}),"Export as Excel (.xlsx)"]})}),t.jsx("li",{children:t.jsxs("button",{className:"dropdown-item",onClick:()=>l("csv"),children:[t.jsx("i",{className:"bi bi-filetype-csv me-2 text-primary"}),"Export as CSV (.csv)"]})}),t.jsx("li",{children:t.jsx("hr",{className:"dropdown-divider"})}),t.jsx("li",{children:t.jsxs("button",{className:"dropdown-item",onClick:()=>{const e=i();console.log("Export Data:",e),navigator.clipboard.writeText(JSON.stringify(e,null,2)).then(()=>alert("Data copied to clipboard!"))},children:[t.jsx("i",{className:"bi bi-clipboard me-2"}),"Copy JSON to Clipboard"]})})]})]})},O=()=>{const[o,p]=x.useState([]),[r,g]=x.useState([]),[i,c]=x.useState(!1),[n,u]=x.useState({page:1,per_page:10,total:0}),[l,e]=x.useState({campaign:"",user:"",stage:""}),s=async(d=1)=>{c(!0);try{const a=await D.getStageWiseLeads(d);p(a.data),g(a.data),u({page:a.current_page,per_page:a.per_page,total:a.total})}catch(a){console.error("Error fetching leads:",a)}finally{c(!1)}};x.useEffect(()=>{s()},[]),x.useEffect(()=>{const d=o.filter(a=>(!l.campaign||a.campaign===l.campaign)&&(!l.user||a.telecaller===l.user)&&(!l.stage||a.stage===l.stage));g(d)},[l,o]);const h=()=>{e({campaign:"",user:"",stage:""})};return t.jsx("div",{className:"container-fluid p-5",children:t.jsxs("div",{className:"card",children:[t.jsx("div",{className:"card-header",children:t.jsx("h1",{className:"mt-5 fw-bold text-gray-800",children:"Stage Wise Lead"})}),t.jsxs("div",{className:"card-body",children:[t.jsx(L,{filters:l,onFilterChange:e,onReset:h,onFetch:()=>s(n.page),leads:o}),t.jsx(M,{leads:r,loading:i,pagination:n,onPageChange:s}),t.jsx(T,{data:r,pagination:n,filename:"leads_report",exportType:"excel"})]})]})})};export{T as ExportButton,L as Filters,M as LeadsTable,O as StageWiseLeadPage};
