import{j as e,M as N,r as d,y as M,S as o,z as T,A as C,B as w}from"./index-BJcvY-Fc.js";const z=({show:p,onClose:u,mode:c,user:i,setUser:r,onSubmit:x})=>{var n,h,j;const g=localStorage.getItem("kt-auth-react-v"),m=g?((j=(h=(n=JSON.parse(g))==null?void 0:n.user)==null?void 0:h.company)==null?void 0:j.teamleader)===1:!0,a={usermid:i.usermid||0,username:i.username||"",userloginid:i.userloginid||"",userpassword:i.userpassword||"",useremail:i.useremail||"",usermobile:i.usermobile||"",userrole:i.userrole||"telecaller",usertype:i.usertype||"User",userstatus:i.userstatus||"Active",designation:i.designation||"",detail:i.detail||"",avatar:i.avatar||"avatars/300-6.jpg",cmpmid:i.cmpmid,initials:i.initials||{label:"",state:"primary"}},t=f=>{const{name:s,value:b}=f.target;r({...a,[s]:b})};return e.jsxs(N,{show:p,onHide:u,size:"lg",children:[e.jsx(N.Header,{closeButton:!0,children:e.jsx(N.Title,{children:c==="add"?"Add New User":"Edit User"})}),e.jsx(N.Body,{children:e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{htmlFor:"username",className:"form-label",children:"Full Name *"}),e.jsx("input",{type:"text",className:"form-control",id:"username",name:"username",value:a.username,onChange:t,placeholder:"Enter full name"})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{htmlFor:"userloginid",className:"form-label",children:"Login ID *"}),e.jsx("input",{type:"text",className:"form-control",id:"userloginid",name:"userloginid",value:a.userloginid,onChange:t,placeholder:"Enter login ID"})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsxs("label",{htmlFor:"userpassword",className:"form-label",children:["Password ",c==="add"?"*":""]}),e.jsx("input",{type:"password",className:"form-control",id:"userpassword",name:"userpassword",value:a.userpassword,onChange:t,placeholder:c==="add"?"Enter Password":"Leave blank to keep current password"}),c==="edit"&&e.jsx("div",{className:"form-text text-muted",children:"Leave password blank to keep the current password"})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{htmlFor:"useremail",className:"form-label",children:"Email *"}),e.jsx("input",{type:"email",className:"form-control",id:"useremail",name:"useremail",value:a.useremail,onChange:t,placeholder:"Enter email address"})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{htmlFor:"usermobile",className:"form-label",children:"Mobile"}),e.jsx("input",{type:"text",className:"form-control",id:"usermobile",name:"usermobile",value:a.usermobile,onChange:t,placeholder:"Enter mobile number"})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{htmlFor:"userrole",className:"form-label",children:"User Role"}),e.jsxs("select",{className:"form-select",id:"userrole",name:"userrole",value:a.userrole,onChange:t,children:[m&&e.jsx("option",{value:"teamleader",children:"Team Leader"}),e.jsx("option",{value:"manager",children:"Manager"}),e.jsx("option",{value:"telecaller",children:"Telecaller"}),e.jsx("option",{value:"admin",children:"Admin"})]})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{htmlFor:"usertype",className:"form-label",children:"User Type"}),e.jsxs("select",{className:"form-select",id:"usertype",name:"usertype",value:a.usertype,onChange:t,disabled:!0,children:[e.jsx("option",{value:"User",children:"User"}),e.jsx("option",{value:"Admin",children:"Admin"})]})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{htmlFor:"userstatus",className:"form-label",children:"Status"}),e.jsxs("select",{className:"form-select",id:"userstatus",name:"userstatus",value:a.userstatus,onChange:t,children:[e.jsx("option",{value:"Active",children:"Active"}),e.jsx("option",{value:"Inactive",children:"Inactive"})]})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{htmlFor:"designation",className:"form-label",children:"Designation"}),e.jsx("input",{type:"text",className:"form-control",id:"designation",name:"designation",value:a.designation,onChange:t,placeholder:"Enter designation"})]}),e.jsxs("div",{className:"col-12",children:[e.jsx("label",{htmlFor:"detail",className:"form-label",children:"Details"}),e.jsx("textarea",{className:"form-control",id:"detail",name:"detail",value:a.detail,onChange:t,placeholder:"Enter additional details",rows:3})]})]})}),e.jsxs(N.Footer,{children:[e.jsx("button",{type:"button",className:"btn btn-light",onClick:u,children:"Cancel"}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:x,children:c==="add"?"Add User":"Update User"})]})]})},D=({users:p,onEdit:u,onDelete:c,loading:i=!1})=>{const[r,x]=d.useState(!0);d.useEffect(()=>{if(i)x(!0);else{const a=setTimeout(()=>x(!1),500);return()=>clearTimeout(a)}},[i]);const g=Array.from({length:6}).map((a,t)=>({key:t})),m=[{title:"Sr.No",width:80,render:(a,t,n)=>r?e.jsx(o.Input,{active:!0,size:"small"}):n+1},{title:"Name",dataIndex:"username",render:(a,t)=>{var n,h;return r?e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(o.Avatar,{active:!0,size:"large",shape:"circle",className:"me-3"}),e.jsx(o.Input,{active:!0,size:"small",className:"w-50"})]}):e.jsxs("div",{className:"d-flex align-items-center px-2 py-2",children:[e.jsx("div",{className:"symbol symbol-40px symbol-circle me-3",children:e.jsx("div",{className:`symbol-label bg-light-${((n=t.initials)==null?void 0:n.state)||"primary"}`,children:e.jsx("span",{className:"text-uppercase fs-7",children:((h=t.initials)==null?void 0:h.label)||t.username.charAt(0)})})}),e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("span",{className:"fw-bold text-gray-800",children:t.username}),e.jsx("span",{className:"text-muted fs-8",children:t.designation})]})]})}},{title:"Email",dataIndex:"useremail",render:a=>r?e.jsx(o.Input,{active:!0,size:"small",className:"w-75"}):a},{title:"Login ID",dataIndex:"userloginid",render:a=>r?e.jsx(o.Input,{active:!0,size:"small",className:"w-50"}):a},{title:"Type",dataIndex:"userrole",render:a=>r?e.jsx(o.Input,{active:!0,size:"small",className:"w-50"}):e.jsx("span",{className:"badge badge-light-primary",children:a})},{title:"Status",dataIndex:"userstatus",render:a=>r?e.jsx(o.Input,{active:!0,size:"small",className:"w-50"}):e.jsx("span",{className:"badge badge-light-success",children:a})},{title:"Actions",fixed:"right",render:(a,t)=>r?e.jsx(o.Button,{active:!0,size:"small",className:"float-end"}):e.jsx(T,{overlay:e.jsxs(C,{children:[e.jsxs(C.Item,{onClick:()=>u(t),children:[e.jsx("i",{className:"bi bi-pencil me-2"}),"Edit"]}),e.jsxs(C.Item,{danger:!0,onClick:()=>c(t.usermid),children:[e.jsx("i",{className:"bi bi-trash me-2"}),"Delete"]})]}),trigger:["click"],children:e.jsxs("button",{className:"btn btn-sm btn-light btn-active-light-primary",children:["Actions ",e.jsx("i",{className:"bi bi-chevron-down ms-2"})]})})}];return e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body p-0",children:e.jsx(M,{columns:m,dataSource:r?g:p.map(a=>({...a,key:a.usermid})),pagination:!1,scroll:{x:"max-content"},locale:{emptyText:r?e.jsx(o,{active:!0,paragraph:{rows:4}}):e.jsxs("div",{className:"py-10 text-center",children:[e.jsx("i",{className:"bi bi-people fs-2x text-muted mb-2"}),e.jsx("div",{className:"text-muted",children:"No users found"})]})}})})})},B=()=>{const[p,u]=d.useState(1),[c,i]=d.useState(10),[r,x]=d.useState({current_page:1,per_page:10,total_records:0,total_pages:1}),[g,m]=d.useState(!1),[a,t]=d.useState("add"),[n,h]=d.useState(""),[j,f]=d.useState([]),[s,b]=d.useState({usermid:0,username:"",userloginid:"",userpassword:"",useremail:"",usermobile:"",userrole:"telecaller",usertype:"User",userstatus:"Active",designation:"",detail:"",avatar:"avatars/300-6.jpg",cmpmid:void 0,initials:{label:"",state:"primary"}}),[k,_]=d.useState(!1);d.useEffect(()=>{y()},[p,c]);const y=async()=>{_(!0);try{const l=await w.getUsersPaginated(p,c);console.log(l.data),f(l.data),x({current_page:l.current_page,per_page:l.per_page,total_records:l.total_records,total_pages:l.total_pages})}catch{f([])}finally{_(!1)}},E=l=>{const v=Number(l.target.value);i(v),u(1)},U=l=>{u(l)},I=async()=>{if(!(!s.username.trim()||!s.useremail.trim()))try{a==="add"?(await w.createUser({username:s.username,userloginid:s.userloginid,userpassword:s.userpassword,useremail:s.useremail,usermobile:s.usermobile,userrole:s.userrole,usertype:s.usertype,userstatus:s.userstatus,designation:s.designation,detail:s.detail,avatar:s.avatar,cmpmid:s.cmpmid,initials:s.initials}),y()):(await w.updateUser(s.usermid,{username:s.username,userloginid:s.userloginid,userpassword:s.userpassword,useremail:s.useremail,usermobile:s.usermobile,userrole:s.userrole,usertype:s.usertype,userstatus:s.userstatus,designation:s.designation,detail:s.detail,avatar:s.avatar,cmpmid:s.cmpmid,initials:s.initials}),y()),b({usermid:0,username:"",userloginid:"",userpassword:"",useremail:"",usermobile:"",userrole:"telecaller",usertype:"User",userstatus:"Active",designation:"",detail:"",avatar:"avatars/300-6.jpg",cmpmid:void 0,initials:{label:"",state:"primary"}}),m(!1)}catch(l){console.error("Error saving user:",l)}},P=l=>{t("edit"),b(l),m(!0)},F=async l=>{if(window.confirm("Are you sure you want to delete this user?"))try{await w.deleteUser(l),y()}catch(v){console.error("Error deleting user:",v)}},L=()=>{t("add"),b({usermid:0,username:"",userloginid:"",userpassword:"",useremail:"",usermobile:"",userrole:"telecaller",usertype:"User",userstatus:"Active",designation:"",detail:"",avatar:"avatars/300-6.jpg",cmpmid:void 0,initials:{label:"",state:"primary"}}),m(!0)},A=Array.isArray(j)?j.filter(l=>l.username.toLowerCase().includes(n.toLowerCase())||l.useremail.toLowerCase().includes(n.toLowerCase())||l.userloginid.toLowerCase().includes(n.toLowerCase())):[],S=Array.isArray(A)?A:[];return e.jsxs("div",{className:"container-fluid py-4",children:[e.jsxs("div",{className:"card shadow-sm",children:[e.jsxs("div",{className:"card-header bg-transparent py-3",children:[e.jsx("div",{className:"d-flex justify-content-between align-items-center",children:e.jsx("div",{children:e.jsx("h1",{className:"fw-bold text-gray-800",children:"User Master"})})}),e.jsxs("button",{onClick:L,className:"btn btn-sm btn-primary d-flex align-items-center gap-2",style:{width:"150px",height:"35px"},children:[e.jsx("i",{className:"bi bi-plus-circle"}),"Add User"]})]}),e.jsxs("div",{className:"card-body",children:[e.jsx("div",{className:"card card-flat mb-4",children:e.jsx("div",{className:"card-body py-3",children:e.jsxs("div",{className:"row align-items-center",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx("label",{className:"form-label mb-0 text-muted",children:"Show"}),e.jsxs("select",{value:c,onChange:E,className:"form-select form-select-sm w-auto",children:[e.jsx("option",{value:"5",children:"5"}),e.jsx("option",{value:"10",children:"10"}),e.jsx("option",{value:"25",children:"25"}),e.jsx("option",{value:"50",children:"50"})]}),e.jsx("label",{className:"form-label mb-0 text-muted",children:"entries"})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"d-flex align-items-center gap-2 justify-content-md-end",children:[e.jsx("label",{className:"form-label mb-0 text-muted",children:"Search:"}),e.jsxs("div",{className:"position-relative",children:[e.jsx("input",{type:"text",placeholder:"Search users...",value:n,onChange:l=>h(l.target.value),className:"form-control form-control-sm"}),e.jsx("i",{className:"bi bi-search position-absolute top-50 end-0 translate-middle-y me-2 text-muted"})]})]})})]})})}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body p-0",children:e.jsx(D,{users:S,onEdit:P,onDelete:F,loading:k})})}),e.jsx("div",{className:"card card-flat mt-4",children:e.jsx("div",{className:"card-body py-3",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{className:"text-muted small",children:["Showing ",S.length," of ",r.total_records," entries",n&&` (filtered from ${j.length} entries on this page)`]}),r.total_pages>1&&e.jsxs("div",{className:"d-flex align-items-center gap-3",children:[e.jsxs("div",{className:"text-muted small",children:["Page ",r.current_page," of ",r.total_pages]}),e.jsx("nav",{children:e.jsxs("ul",{className:"pagination pagination-sm mb-0",children:[e.jsx("li",{className:`page-item ${r.current_page===1?"disabled":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>U(r.current_page-1),disabled:r.current_page===1,children:"Previous"})}),Array.from({length:r.total_pages},(l,v)=>v+1).map(l=>e.jsx("li",{className:`page-item ${r.current_page===l?"active":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>U(l),children:l})},l)),e.jsx("li",{className:`page-item ${r.current_page===r.total_pages?"disabled":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>U(r.current_page+1),disabled:r.current_page===r.total_pages,children:"Next"})})]})})]})]})})})]})]}),e.jsx(z,{show:g,onClose:()=>m(!1),mode:a,user:s,setUser:b,onSubmit:I})]})};export{B as default};
