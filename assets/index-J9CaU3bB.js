import{ac as w,aG as b,aH as _,aF as C,r as x,j as e,ax as k,ay as N,au as f,at as y,bj as L,av as S,az as p,aB as P,bk as z}from"./index-BJcvY-Fc.js";const I="https://leadzcrm.linkarise.in/api",E=async t=>{try{return(await w.post(`${I}/lead/leadsummary`,{current_page:t.page,per_page:t.perPage,search:t.search||"",date_from:t.dateFrom||"",date_to:t.dateTo||"",sort_by:t.sortBy||"user",sort_order:t.sortOrder||"asc"},{headers:{"Content-Type":"application/json",Accept:"application/json","Access-Control-Allow-Origin":"*"},withCredentials:!1})).data}catch(r){throw console.error("Error fetching lead summary:",r),r}},T=t=>{const r=t.map(c=>({User:c.user,"Total Leads":c.total_lead,"Fresh Leads":c.fresh,Followup:c.followup,Interested:c.interested,Converted:c.converted,"Not Interested":c.not_interested})),l=b.json_to_sheet(r),s=b.book_new();b.book_append_sheet(s,l,"Lead Summary");const a=[{wch:20},{wch:12},{wch:12},{wch:12},{wch:12},{wch:12},{wch:15}];l["!cols"]=a;const o=_(s,{bookType:"xlsx",type:"array"}),d=new Blob([o],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-8"});C.saveAs(d,`lead_summary_${new Date().toISOString().split("T")[0]}.xlsx`)},F=()=>{const[t,r]=x.useState([]),[l,s]=x.useState(!0),[a,o]=x.useState(null),[d,c]=x.useState({page:1,perPage:10,search:"",sortBy:"user",sortOrder:"asc"}),[i,g]=x.useState(null),h=x.useCallback(async()=>{s(!0),o(null);try{const n=await E(d);n.status&&n.data&&(r(n.data.data),g({currentPage:n.data.current_page,totalPages:n.data.last_page,totalItems:n.data.total,from:n.data.from,to:n.data.to,perPage:n.data.per_page,hasNextPage:!!n.data.next_page_url,hasPrevPage:!!n.data.prev_page_url}))}catch(n){o(n),console.error("Error loading lead summary:",n)}finally{s(!1)}},[d]);x.useEffect(()=>{h()},[h]);const u=x.useCallback(n=>{c(j=>({...j,search:n,page:1}))},[]),m=x.useCallback(n=>{c(j=>({...j,page:n}))},[]),v=x.useCallback(n=>{c(j=>({...j,perPage:n,page:1}))},[]);return{data:t,loading:l,error:a,filters:d,pagination:i,handleSearch:u,handlePageChange:m,handlePageSizeChange:v,refetch:h}},A=()=>e.jsxs("div",{className:"mb-4",children:[e.jsx("h1",{className:"h2 mb-1",style:{color:"#2c3e50",fontWeight:"600",fontSize:"1.75rem"},children:"Total Lead Summary"}),e.jsx("div",{className:"border-top mt-3"})]}),D=({pageSize:t,searchTerm:r,onPageSizeChange:l,onSearchChange:s,onExport:a})=>e.jsxs(k,{className:"mb-3 align-items-center",children:[e.jsx(N,{md:6,className:"d-flex align-items-center",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("span",{className:"me-2",style:{color:"#666",fontSize:"0.9rem"},children:"Show"}),e.jsxs(f.Select,{value:t,onChange:o=>l(Number(o.target.value)),style:{width:"70px",height:"40px",fontSize:"0.875rem"},className:"me-2",children:[e.jsx("option",{value:"10",children:"10"}),e.jsx("option",{value:"25",children:"25"}),e.jsx("option",{value:"50",children:"50"}),e.jsx("option",{value:"100",children:"100"})]}),e.jsx("span",{style:{color:"#666",fontSize:"0.9rem"},children:"entries"})]})}),e.jsx(N,{md:6,className:"d-flex justify-content-end",children:e.jsxs("div",{className:"d-flex gap-2",children:[e.jsxs(y,{style:{width:"250px"},children:[e.jsx(y.Text,{children:e.jsx("i",{className:"bi bi-search",style:{fontSize:"0.875rem"}})}),e.jsx(f.Control,{type:"text",placeholder:"Search...",value:r,onChange:o=>s(o.target.value),style:{height:"32px",fontSize:"0.875rem"}})]}),a&&e.jsxs(L,{variant:"outline-primary",onClick:a,style:{height:"32px",padding:"0 0.75rem",fontSize:"0.875rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("i",{className:"bi bi-file-earmark-excel",style:{fontSize:"0.875rem"}}),e.jsx("span",{children:"Export Excel"})]})]})})]}),R=({data:t,loading:r})=>{const l=()=>e.jsx("div",{className:"placeholder-wave w-100",children:e.jsx("span",{className:"placeholder col-12",style:{height:"20px",display:"block",borderRadius:"4px"}})}),s=Array.from({length:8}).map((a,o)=>e.jsx("tr",{children:Array.from({length:7}).map((d,c)=>e.jsx("td",{children:e.jsx(l,{})},c))},o));return r?e.jsx("div",{className:"table-responsive",children:e.jsxs(S,{striped:!0,bordered:!0,hover:!0,className:"mb-0",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{children:"User"}),e.jsx("th",{className:"text-center",children:"Total Leads"}),e.jsx("th",{className:"text-center",children:"Fresh Leads"}),e.jsx("th",{className:"text-center",children:"Followup"}),e.jsx("th",{className:"text-center",children:"Interested"}),e.jsx("th",{className:"text-center",children:"Converted"}),e.jsx("th",{className:"text-center",children:"Not Interested"})]})}),e.jsx("tbody",{children:s})]})}):!t||t.length===0?e.jsx("div",{className:"text-center py-5",children:e.jsx("p",{className:"text-muted",children:"No lead summary data available"})}):e.jsx("div",{className:"table-responsive",children:e.jsxs(S,{striped:!0,bordered:!0,hover:!0,className:"mb-0",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{children:"User"}),e.jsx("th",{className:"text-center",children:"Total Leads"}),e.jsx("th",{className:"text-center",children:"Fresh Leads"}),e.jsx("th",{className:"text-center",children:"Followup"}),e.jsx("th",{className:"text-center",children:"Interested"}),e.jsx("th",{className:"text-center",children:"Converted"}),e.jsx("th",{className:"text-center",children:"Not Interested"})]})}),e.jsx("tbody",{children:t.map((a,o)=>e.jsxs("tr",{children:[e.jsx("td",{children:a.user}),e.jsx("td",{className:"text-center",children:a.total_lead.toLocaleString()}),e.jsx("td",{className:"text-center",children:a.fresh.toLocaleString()}),e.jsx("td",{className:"text-center",children:a.followup.toLocaleString()}),e.jsx("td",{className:"text-center",children:a.interested.toLocaleString()}),e.jsx("td",{className:"text-center",children:a.converted.toLocaleString()}),e.jsx("td",{className:"text-center",children:a.not_interested.toLocaleString()})]},o))})]})})},B=({pagination:t,onPageChange:r})=>{if(!t||t.totalPages<=1)return null;const{currentPage:l,totalPages:s,from:a,to:o,totalItems:d}=t,c=()=>{const i=[];let h=Math.max(1,l-Math.floor(2.5)),u=Math.min(s,h+5-1);u-h+1<5&&(h=Math.max(1,u-5+1)),i.push(e.jsx(p.Prev,{onClick:()=>r(l-1),disabled:l===1},"prev")),h>1&&(i.push(e.jsx(p.Item,{active:l===1,onClick:()=>r(1),children:"1"},1)),h>2&&i.push(e.jsx(p.Ellipsis,{},"ellipsis-start")));for(let m=h;m<=u;m++)i.push(e.jsx(p.Item,{active:m===l,onClick:()=>r(m),children:m},m));return u<s&&(u<s-1&&i.push(e.jsx(p.Ellipsis,{},"ellipsis-end")),i.push(e.jsx(p.Item,{active:s===l,onClick:()=>r(s),children:s},s))),i.push(e.jsx(p.Next,{onClick:()=>r(l+1),disabled:l===s},"next")),i};return e.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-3",children:[e.jsxs("div",{className:"text-muted",style:{fontSize:"0.875rem"},children:["Showing ",a," to ",o," of ",d.toLocaleString()," entries"]}),e.jsx(p,{className:"mb-0",children:c()})]})},V=()=>{const{data:t,loading:r,error:l,filters:s,pagination:a,handleSearch:o,handlePageSizeChange:d,handlePageChange:c,refetch:i}=F(),g=()=>{T(t)};return e.jsxs(P,{fluid:!0,className:"py-4",children:[e.jsx(A,{}),e.jsx("div",{className:"card shadow-sm",children:e.jsxs("div",{className:"card-body",children:[e.jsx(D,{pageSize:s.perPage,searchTerm:s.search||"",onPageSizeChange:d,onSearchChange:o,onExport:g}),l&&e.jsxs(z,{variant:"danger",className:"mb-3",children:["Error: ",l.message,e.jsx("button",{className:"btn btn-sm btn-outline-danger ms-2",onClick:()=>i(),children:"Retry"})]}),e.jsx(R,{data:t,loading:r}),a&&a.totalPages>1&&e.jsx(B,{pagination:a,onPageChange:c}),e.jsx("div",{className:"mt-4 pt-3 border-top",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{className:"text-muted",style:{fontSize:"0.875rem"},children:["Data last updated: ",new Date().toLocaleDateString()]}),e.jsx("button",{className:"btn btn-link text-decoration-none",onClick:()=>i(),disabled:r,children:"Refresh Data"})]})})]})})]})};export{V as LeadSummaryPage,T as exportToExcel,E as fetchLeadSummary,F as useLeadSummary};
